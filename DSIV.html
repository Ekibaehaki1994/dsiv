<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSIV Ultimate Pro - Dual Perspective Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --apple-black: #1d1d1f; --apple-grey: #86868b; --apple-blue: #0071e3; 
            --apple-red: #d70015; --apple-yellow: #f5a623; --dark-bg: #0d1117; 
            --dark-card: #161b22; --dark-border: #30363d; --apple-green: #34c759;
        }
        body { background: var(--dark-bg); color: #e6e6e6; font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 0; padding: 40px 20px; display: flex; flex-direction: column; align-items: center; }
        .input-card { background: var(--dark-card); width: 100%; max-width: 500px; padding: 30px; border: 1px solid var(--dark-border); box-sizing: border-box; border-radius: 8px; }
        h2 { font-size: 16px; margin: 0 0 20px 0; letter-spacing: 1px; color: var(--apple-blue); }
        label { display: block; font-size: 10px; color: #8b949e; text-transform: uppercase; margin: 15px 0 5px 0; font-weight: 600; }
        input { width: 100%; padding: 12px; background: #0d1117; border: 1px solid var(--dark-border); color: #fff; border-radius: 6px; outline: none; box-sizing: border-box; font-size: 14px; }
        .btn-calc { background: var(--apple-blue); color: #fff; border: none; padding: 16px; width: 100%; font-weight: 700; cursor: pointer; margin-top: 25px; border-radius: 6px; }
        
        /* RESULT CARD */
        #capture-area { display: none; width: 550px; background: #fff; padding: 45px; color: var(--apple-black); box-sizing: border-box; }
        .ticker { font-size: 48px; font-weight: 900; letter-spacing: -2px; margin: 0; line-height: 1; }
        .sub { font-size: 10px; color: var(--apple-blue); font-weight: 700; letter-spacing: 3px; margin: 8px 0 25px 0; text-transform: uppercase; }
        
        .metrics-grid { border-top: 2px solid #000; padding: 15px 0; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .m-item { font-size: 11px; color: var(--apple-grey); }
        .m-item b { color: #000; float: right; font-weight: 700; }
        
        /* DUAL PERCENTAGE BOX */
        .dual-box-container { display: flex; gap: 15px; margin: 15px 0; }
        .p-box { flex: 1; padding: 15px; border-radius: 4px; text-align: center; color: #fff; }
        .p-label { font-size: 8px; font-weight: 800; letter-spacing: 1px; opacity: 0.9; margin-bottom: 5px; text-transform: uppercase; }
        .p-value { font-size: 24px; font-weight: 900; }

        .proj-table { width: 100%; border-collapse: collapse; margin: 15px 0 25px 0; table-layout: fixed; }
        .proj-table th { font-size: 8px; color: var(--apple-grey); text-align: left; border-bottom: 1px solid #eee; padding: 10px 0; text-transform: uppercase; }
        .proj-table td { font-size: 10px; padding: 12px 0; border-bottom: 1px solid #f5f5f7; font-weight: 600; }
        .target-col { color: var(--apple-blue); }

        .footer { margin-top: 35px; text-align: center; font-size: 10px; letter-spacing: 5px; font-weight: 800; border-top: 1px solid #eee; padding-top: 20px; color: #000; }
        .footer span { font-weight: 400; letter-spacing: 1px; color: var(--apple-grey); display: block; margin-top: 5px; font-size: 8px; }

        /* Status Colors */
        .bg-blue { background: var(--apple-blue); }
        .bg-red { background: var(--apple-red); }
        .bg-yellow { background: var(--apple-yellow); }
        .bg-green { background: var(--apple-green); }
        .bg-dark { background: #1d1d1f; }
    </style>
</head>
<body>

    <div class="input-card">
        <h2>DSIV ANALYTICS PRO V2</h2>
        <label>Stock Ticker</label><input type="text" id="ticker" placeholder="TICKER">
        
        <div style="display:flex; gap:12px">
            <div style="flex:1"><label>Current Price</label><input type="number" id="price" placeholder="Harga Sekarang"></div>
            <div style="flex:1"><label>EPS TTM</label><input type="number" id="eps" placeholder="EPS TTM"></div>
        </div>
        <div style="display:flex; gap:12px">
            <div style="flex:1"><label>BVPS (Anchor)</label><input type="number" id="bvps" placeholder="BVPS"></div>
            <div style="flex:1"><label>Annual Dividend</label><input type="number" id="div_val" placeholder="Dividen IDR"></div>
        </div>
        <div style="display:flex; gap:12px">
            <div style="flex:1"><label>Mean PBV</label><input type="number" id="pbv_m" step="0.01" placeholder="Mean PBV"></div>
            <div style="flex:1"><label>Current PBV</label><input type="number" id="pbv_n" step="0.01" placeholder="Now PBV"></div>
        </div>
        <label>ROE TTM (%)</label><input type="number" id="roe_t" placeholder="ROE %">
        
        <div id="roe_extra"></div>
        <button onclick="addROE()" style="background:none; border:1px dashed #444; color:#8b949e; width:100%; padding:10px; cursor:pointer; font-size:11px; margin-top:12px">+ DATA ROE LAIN</button>
        <button class="btn-calc" onclick="calculate()">GENERATE DUAL PERSPECTIVE</button>
    </div>

    <div id="capture-area">
        <h1 class="ticker" id="r-ticker">STOCK</h1>
        <div class="sub">5-Year Strategic Equity Valuation</div>
        
        <div class="metrics-grid">
            <div class="m-item">Adaptive ROE: <b id="r-roe-final">-</b></div>
            <div class="m-item">WQF Multiplier: <b id="r-wqf">-</b></div>
            <div class="m-item">Dividend Yield: <b id="r-yield">-</b></div>
            <div class="m-item">Current Price: <b id="r-price">-</b></div>
        </div>

        <div class="dual-box-container">
            <div id="box-tp1" class="p-box bg-dark">
                <div class="p-label">Current MoS (TP1)</div>
                <div class="p-value" id="r-up-tp1">0%</div>
            </div>
            <div id="box-tp2" class="p-box bg-blue">
                <div class="p-label">5Y Long Upside (TP2)</div>
                <div class="p-value" id="r-up-tp2">0%</div>
            </div>
        </div>

        <table class="proj-table">
            <thead>
                <tr>
                    <th style="width:14%">YEAR</th>
                    <th style="width:20%">BVPS</th>
                    <th style="width:23%">FLOOR (TP1)</th>
                    <th style="width:25%">TARGET (TP2)</th>
                    <th style="width:18%">IMP. PER</th>
                </tr>
            </thead>
            <tbody id="r-body"></tbody>
        </table>

        <div class="footer">
            @SILENT.BAGGER
            <span id="r-date">DATE ANALYSED</span>
        </div>
    </div>
    
    <button id="btn-save" style="display:none; margin:30px; padding:18px 50px; cursor:pointer" onclick="save()">SAVE IMAGE</button>

<script>
function addROE() {
    const d = document.createElement("div"); d.style.display="flex"; d.style.gap="8px"; d.style.marginTop="8px";
    d.innerHTML = `<input type="number" class="roe-e" placeholder="ROE %" style="flex:1"><button onclick="this.parentElement.remove()" style="background:#f8514922; color:#f85149; border:1px solid #f85149; padding:5px 12px; cursor:pointer">Ã—</button>`;
    document.getElementById("roe_extra").appendChild(d);
}

function calculate() {
    const p = parseFloat(document.getElementById("price").value),
          e = parseFloat(document.getElementById("eps").value),
          b = parseFloat(document.getElementById("bvps").value),
          divVal = parseFloat(document.getElementById("div_val").value) || 0,
          pm = parseFloat(document.getElementById("pbv_m").value),
          pn = parseFloat(document.getElementById("pbv_n").value),
          rt = parseFloat(document.getElementById("roe_t").value);
    
    if(isNaN(p) || isNaN(e) || isNaN(b)) return alert("Isi data utama dulu.");

    const ex = [...document.querySelectorAll(".roe-e")].map(i=>parseFloat(i.value)).filter(v=>!isNaN(v));
    const all = [rt, ...ex].sort((a,b)=>a-b);
    const med = all.length%2?all[Math.floor(all.length/2)]:(all[all.length/2-1]+all[all.length/2])/2;
    const adp_val = (med+rt)/2;
    const adp_pct = adp_val/100; 
    const wqf = (pm*0.7)+(pn*0.3);

    let rows = "", currB = b, firstFloor = 0, finalTP2 = 0;
    
    for(let i=0; i<5; i++){
        let yr = new Date().getFullYear() + i;
        if(i > 0) currB *= (1 + adp_pct);
        
        let tp1 = currB * wqf;
        let tp2 = currB * (1 + adp_pct) * wqf;
        
        if(i === 0) firstFloor = tp1;
        if(i === 4) finalTP2 = tp2;

        rows += `<tr>
            <td>${yr}</td>
            <td>${Math.round(currB).toLocaleString("id-ID")}</td>
            <td style="color:#666">IDR ${Math.round(tp1).toLocaleString("id-ID")}</td>
            <td class="target-col">IDR ${Math.round(tp2).toLocaleString("id-ID")}</td>
            <td>${(tp2/e).toFixed(1)}x</td>
        </tr>`;
    }

    const upTP1 = ((firstFloor/p)-1)*100;
    const upTP2 = ((finalTP2/p)-1)*100;

    // Logic Warna Box TP1 (MoS)
    const box1 = document.getElementById("box-tp1");
    box1.className = "p-box";
    if(upTP1 > 0) box1.classList.add("bg-green"); // Harga di bawah floor = MURAH
    else box1.classList.add("bg-red"); // Harga di atas floor = MAHAL

    // Logic Warna Box TP2 (Upside)
    const box2 = document.getElementById("box-tp2");
    box2.className = "p-box";
    if(upTP2 < 0) box2.classList.add("bg-red");
    else if(upTP2 < 10) box2.classList.add("bg-yellow");
    else box2.classList.add("bg-blue");

    document.getElementById("r-ticker").innerText = document.getElementById("ticker").value.toUpperCase() || "STOCK";
    document.getElementById("r-roe-final").innerText = adp_val.toFixed(1)+"%";
    document.getElementById("r-wqf").innerText = wqf.toFixed(2)+"x";
    document.getElementById("r-yield").innerText = ((divVal/p)*100).toFixed(2)+"%";
    document.getElementById("r-price").innerText = "IDR "+p.toLocaleString("id-ID");
    document.getElementById("r-body").innerHTML = rows;
    
    document.getElementById("r-up-tp1").innerText = (upTP1 > 0 ? "+" : "") + upTP1.toFixed(1) + "%";
    document.getElementById("r-up-tp2").innerText = (upTP2 > 0 ? "+" : "") + upTP2.toFixed(1) + "%";
    
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById("r-date").innerText = new Date().toLocaleDateString('en-US', options).toUpperCase();
    
    document.getElementById("capture-area").style.display = "block";
    document.getElementById("btn-save").style.display = "block";
}

function save() { 
    html2canvas(document.getElementById("capture-area"),{scale:4}).then(c=>{
        const a=document.createElement('a'); 
        a.download="DSIV-DUAL-"+document.getElementById("ticker").value+".png"; 
        a.href=c.toDataURL(); a.click();
    }); 
}
</script>
</body>
</html>